{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/index.tsx"],"sourcesContent":["import { useEffect, useLayoutEffect as useOriginalLayoutEffect } from 'react';\n\nexport const OLARK_CONTAINER_ID = 'olark-box-container';\n\nexport function isBrowser() {\n  return typeof window !== 'undefined' && typeof document !== 'undefined';\n}\n\n// React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\n// @see https://gist.github.com/gaearon/e7d97cdf38a2907924ea12e4ebdf3c85\nexport const useIsomorphicLayoutEffect = isBrowser()\n  ? useOriginalLayoutEffect\n  : useEffect;\n\nexport function olarkSnippetExists() {\n  return isBrowser() && 'olarkReact' in window;\n}\n\nexport function olarkWasLaunched() {\n  return olarkSnippetExists() && !!window.olarkReact.olarkWasLaunched;\n}\n\nexport function olarkExists() {\n  return isBrowser() && !!window.olark;\n}\n\nexport function olarkContainerExists() {\n  return isBrowser() && !!document.getElementById(OLARK_CONTAINER_ID);\n}\n\nexport function injectOlarkSnippet(siteId: string) {\n  /*\n   * Force users to include a `siteId` prop.\n   */\n  if (!siteId) {\n    throw new Error('The `Olark` component must be given a `siteId` prop.');\n  }\n\n  /*\n   * Generate the olark script and append it to the body.\n   */\n  if (isBrowser() && !olarkSnippetExists()) {\n    const script = document.createElement('script');\n    script.setAttribute('id', 'olark-react-snippet');\n    script.setAttribute('type', 'text/javascript');\n    script.setAttribute('async', 'true');\n    script.innerHTML = `\n        window.olarkReact = function (systemConfig, localeConfig, boxConfig) {\n          ;(function(o,l,a,r,k,y){if(o.olark)return;\n          r=\"script\";y=l.createElement(r);r=l.getElementsByTagName(r)[0];\n          y.async=1;y.src=\"//\"+a;r.parentNode.insertBefore(y,r);\n          y=o.olark=function(){k.s.push(arguments);k.t.push(+new Date)};\n          y.extend=function(i,j){y(\"extend\",i,j)};\n          y.identify=function(i){y(\"identify\",k.i=i)};\n          y.configure=function(i,j){y(\"configure\",i,j);k.c[i]=j};\n          k=y._={s:[],t:[+new Date],c:{},l:a};\n          })(window,document,\"static.olark.com/jsclient/loader0.js\");\n          /* Add configuration calls bellow this comment */\n\n          // Run through all the system config.\n          Object.keys(boxConfig || {}).forEach(function (key) {\n            olark.configure('box.' + key, boxConfig[key]);\n          });\n\n          // Run through all the system config.\n          Object.keys(systemConfig || {}).forEach(function (key) {\n            olark.configure('system.' + key, systemConfig[key]);\n          });\n\n          // Run through all the local config.\n          Object.keys(localeConfig || {}).forEach(function (key) {\n            olark.configure('locale.' + key, localeConfig[key]);\n          });\n\n          // Identify the site and mark the script as launched.\n          olark.identify('${siteId}');\n          window.olarkReact.olarkWasLaunched = true;\n        };\n      `;\n    document.body.appendChild(script);\n  }\n}\n","import React, { useEffect } from 'react';\nimport {\n  olarkContainerExists,\n  olarkExists,\n  olarkWasLaunched,\n  OLARK_CONTAINER_ID,\n  olarkSnippetExists,\n  useIsomorphicLayoutEffect,\n  injectOlarkSnippet,\n} from './utils';\nimport { IOlarkBoxConfig, IOlarkSystemConfig } from './types';\n\nexport interface IOlarkProps {\n  siteId: string;\n  systemConfig?: IOlarkSystemConfig;\n  localeConfig?: object;\n  boxConfig?: IOlarkBoxConfig;\n}\n\nconst Olark: React.FC<IOlarkProps> = (props) => {\n  const {\n    siteId,\n    systemConfig = {},\n    boxConfig = {},\n    localeConfig = {},\n  } = props;\n\n  function launchOlark() {\n    if (olarkSnippetExists() && !olarkWasLaunched()) {\n      window.olarkReact(systemConfig, localeConfig, boxConfig);\n      window.olark('api.chat.onReady', () => {\n        const container = document.getElementById(\n          OLARK_CONTAINER_ID\n        ) as HTMLDivElement;\n        const classes = container.className;\n        if (classes.indexOf('olark-loaded') === -1) {\n          container.className = container.className + ' olark-loaded';\n        }\n      });\n    }\n  }\n\n  function resetOlark() {\n    if (olarkExists()) {\n      window.olark._.reset();\n    }\n  }\n\n  useIsomorphicLayoutEffect(function injectingEffect() {\n    injectOlarkSnippet(siteId);\n  }, []);\n\n  useEffect(function mountEffect() {\n    if (!olarkWasLaunched()) {\n      launchOlark();\n    } else if (!olarkContainerExists()) {\n      resetOlark();\n    }\n  }, []);\n\n  return <div id={OLARK_CONTAINER_ID} />;\n};\n\nexport default React.memo(\n  Olark,\n  // Don't allow this component to re-render while it is live.\n  () => false\n);\n"],"names":["useOriginalLayoutEffect","useEffect","React"],"mappings":";;;;;;;;;;AAEO,IAAM,kBAAkB,GAAG,qBAAqB,CAAC;SAExC,SAAS;IACvB,OAAO,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,WAAW,CAAC;AAC1E,CAAC;AAED;AACA;AACA;AACA;AACO,IAAM,yBAAyB,GAAG,SAAS,EAAE;MAChDA,qBAAuB;MACvBC,eAAS,CAAC;SAEE,kBAAkB;IAChC,OAAO,SAAS,EAAE,IAAI,YAAY,IAAI,MAAM,CAAC;AAC/C,CAAC;SAEe,gBAAgB;IAC9B,OAAO,kBAAkB,EAAE,IAAI,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC;AACtE,CAAC;SAEe,WAAW;IACzB,OAAO,SAAS,EAAE,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;AACvC,CAAC;SAEe,oBAAoB;IAClC,OAAO,SAAS,EAAE,IAAI,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;AACtE,CAAC;SAEe,kBAAkB,CAAC,MAAc;;;;IAI/C,IAAI,CAAC,MAAM,EAAE;QACX,MAAM,IAAI,KAAK,CAAC,sDAAsD,CAAC,CAAC;KACzE;;;;IAKD,IAAI,SAAS,EAAE,IAAI,CAAC,kBAAkB,EAAE,EAAE;QACxC,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,qBAAqB,CAAC,CAAC;QACjD,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC;QAC/C,MAAM,CAAC,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACrC,MAAM,CAAC,SAAS,GAAG,83CA6BK,MAAM,kFAG3B,CAAC;QACJ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;KACnC;AACH;;AChEA,IAAM,KAAK,GAA0B,UAAC,KAAK;IAEvC,IAAA,MAAM,GAIJ,KAAK,OAJD,EACN,KAGE,KAAK,aAHU,EAAjB,YAAY,mBAAG,EAAE,KAAA,EACjB,KAEE,KAAK,UAFO,EAAd,SAAS,mBAAG,EAAE,KAAA,EACd,KACE,KAAK,aADU,EAAjB,YAAY,mBAAG,EAAE,KAAA,CACT;IAEV,SAAS,WAAW;QAClB,IAAI,kBAAkB,EAAE,IAAI,CAAC,gBAAgB,EAAE,EAAE;YAC/C,MAAM,CAAC,UAAU,CAAC,YAAY,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC;YACzD,MAAM,CAAC,KAAK,CAAC,kBAAkB,EAAE;gBAC/B,IAAM,SAAS,GAAG,QAAQ,CAAC,cAAc,CACvC,kBAAkB,CACD,CAAC;gBACpB,IAAM,OAAO,GAAG,SAAS,CAAC,SAAS,CAAC;gBACpC,IAAI,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE;oBAC1C,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS,GAAG,eAAe,CAAC;iBAC7D;aACF,CAAC,CAAC;SACJ;KACF;IAED,SAAS,UAAU;QACjB,IAAI,WAAW,EAAE,EAAE;YACjB,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;SACxB;KACF;IAED,yBAAyB,CAAC,SAAS,eAAe;QAChD,kBAAkB,CAAC,MAAM,CAAC,CAAC;KAC5B,EAAE,EAAE,CAAC,CAAC;IAEPA,eAAS,CAAC,SAAS,WAAW;QAC5B,IAAI,CAAC,gBAAgB,EAAE,EAAE;YACvB,WAAW,EAAE,CAAC;SACf;aAAM,IAAI,CAAC,oBAAoB,EAAE,EAAE;YAClC,UAAU,EAAE,CAAC;SACd;KACF,EAAE,EAAE,CAAC,CAAC;IAEP,OAAOC,iDAAK,EAAE,EAAE,kBAAkB,GAAI,CAAC;AACzC,CAAC,CAAC;AAEF,YAAeA,yBAAK,CAAC,IAAI,CACvB,KAAK;AACL;AACA,cAAM,OAAA,KAAK,GAAA,CACZ;;;;"}